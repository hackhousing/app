![travis badge](https://travis-ci.org/LocalStory/LocalStoryJS.svg?branch=master)
LocalStory API
=========================

Authentication
------------------
*SIGNING UP*
  * Expect multipart/form-data with the following fields:
    * 'email'
    * 'password'
    * 'passwordConfirm'
  * Returns JWT

*SIGNING IN*
  * Expect via HTTP Basic:
    * 'email'
    * 'password'
  * Returns JWT

*AUTHENTICATED ROUTES*
  * Expect JWT in request header, with key 'jwt'


Routes
------------------
*GET*
  * `/api/stories/location/`
    * Returns array of story objects within lat/lng rectangular area
    * Non-authenticated
    * Expected request headers: 'latMin', 'latMax', 'lngMin', 'lngMax'
    * If there are greater than 200 stories within the rectangular area, will return count of stories
  * `/api/stories/single/image/:storyId`
    * Returns the story's associated image, if exists, as chunked data
    * Non-authenticated
  * `/api/stories/user/`
    * Returns array of story objects belonging to the current user
    * Authenticated
  * `/api/users`
    * Signs user into the service; returns JWT
    * Expect 'email' and 'password' via HTTP Basic

*POST*
  * `/api/stories/`
    * Add story to the database
    * Authenticated
    * Expect multipart/form-data with the following fields:
      * 'title' (required)
      * 'storyBody' (required)
      * 'lat' (required)
      * 'lng' (required)
      * 'file' (optional; an associated image as binary data)
  * `/api/users`
    * Register new user
    * Expect multipart/form-data with the following fields (all required):
      * 'email'
      * 'password'
      * 'passwordConfirm'

*PUT*
  * `/api/stories/single/:storyId`
    * Modifies the story of ID req.params.storyId
    * Authenticated
    * Ensures only the author of the given story can modify
    * Expect multipart/form-data with *any* of the following fields
      * 'title'
      * 'storyBody'
      * 'file'

Example Return Objects (JSON)
------------------
*STORY*
  ```javascript
  {
    "_id": "[the story ID (generated by the server)]",
    "userId": "[the user ID of the author (generated by the server)]",
    "title": "[the story's title]",
    "storyBody": "[the body of the story]",
    "lat": "[latitude of the story]",
    "lng": "[longitude of the story]",
    "date": "[date the story was posted (generated by the server)]"
  }
  ```
*JWT*
  ```javascript
  {"jwt": "[JavaScript Web Token string]"}
  ```

Server Response Codes
------------------
* 200: OK
* 403: Not authorized. Either a valid JWT was not included in the request header, a user attempted to modify a story that the user did not author, or basic auth (username + password) failed.
* 500: Non-specified error. Lacks detail for security reasons. You might get a 500 if there was a database error, if you try to create a duplicate user, and for other reasons. Check res.body for the minimal details provided.
